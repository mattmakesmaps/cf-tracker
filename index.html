<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <title>Sheetsee Table Demo</title>
    <meta name='viewport' content='width=device-width, initial-scale=1.0'/>
    <script type='text/javascript' src='https://ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js'></script>
    <script type='text/javascript' src='js/tabletop.js'></script>
    <script type='text/javascript' src='js/sheetsee.js'></script>
    <link rel='stylesheet' type='text/css' href='css/sss.css'>
  </head>

  <style>
    input {
        border: none;
        border-bottom: 1px solid #333;
        margin: 10px 0px;
        width: 200px;
        font-size: 16px;
        padding-bottom: 6px;
    }
  </style>

  <body>
      <div class="container">
        <h2>Weight Over Time</h2>
        <div id="lineChart"></div>
        <h2>Data Table</h2>
        <input id="fullTableFilter" type="text" placeholder="filter by..">
        <div id="fullTable"></div>
        <h2>Movement Notes</h2>
        <div id="notesDisplay"></div>
        <h2>Movement Stats</h2>
        <div id="statsDisplay"></div>
      </div>

      <script id="notesDisplay" type="text/html">
          <ul>
          {{#rows}}
              {{#notes}}
              <li>{{notes}}</li>
              {{/notes}}
          {{/rows}}
          </ul>
      </script>

<script id="fullTable" type="text/html">
  <table>
    <tr>
        <th class="tHeader">Date</th>
        <th class="tHeader">Movement</th>
        <th class="tHeader">Weight (KG)</th>
        <th class="tHeader">PR</th>
    </tr>
      {{#rows}}
        <tr>
            <td>{{date}}</td>
            <td>{{movement}}</td>
            <td>{{weightkg}}</td>
            <td>{{pr}}</td>
        </tr>
      {{/rows}}
  </table>
</script>


<script type="text/javascript">
  // Using jQuery DOM Ready Format
  $(document).ready(function(){
      var URL = "13C8ZxRoVam5a7fYddnlCmRinc3U7j8gaLHgs6ElkGnQ";
      Tabletop.init(
              {
                  key: URL,
                  callback: showInfo,
                  simpleSheet: true,
                  parseNumbers: true,
                  postProcess: function(element) {
                      element["timestamp"] = Date.parse(element["date"])
                  }
              }
      );
  });

  function showInfo(data) {

      // Populate the Data Table
      var tableOptions = {
          "data": data,
          "pagination": 10,
          "tableDiv": "#fullTable",
          "filterDiv": "#fullTableFilter"
      };
      Sheetsee.makeTable(tableOptions);
      Sheetsee.initiateTableFilter(tableOptions);

      // Create the Initial Line Chart
      var lineOptions = {
          labels: "timestamp",
          units: "weightkg",
          m: [50, 50, 50, 50],
          w: 600,
          h: 300,
          div: "#lineChart",
          hiColor: "#14ECC8"};
      Sheetsee.d3LineChart(data, lineOptions);

      // User Clicks a Table Cell
      var fullTable = document.getElementById("fullTable");
      fullTable.addEventListener("click", function(evt){
          // Contents of clicked cell
          var filter_text = evt.target.innerText;
          // All records for the movement a user clicked.
          var clicked_data = Sheetsee.getMatches(data, filter_text, "movement");

          // The non-jQuery way to nuke div contents
          // http://stackoverflow.com/questions/5057759/how-do-i-clear-the-contents-of-a-div-without-innerhtml
          var chart_div = document.getElementById("lineChart");
          while (chart_div.hasChildNodes()) {
              chart_div.removeChild(chart_div.firstChild);
          }
          // Replace the chart
          Sheetsee.d3LineChart(clicked_data, lineOptions);


          // Update Notes List. Note we're using ich built with
          // Sheetsee, as opposed to a separate ich lib.
          var notes_html;
          notes_html = Sheetsee.ich.notesDisplay({
              rows: clicked_data
          });
          $('#notesDisplay').html(notes_html);
      }, false);

  }
</script>

</body>
</html>